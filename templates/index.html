<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quiz Creator</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .question { margin: 15px 0; padding: 10px; border: 1px solid #ddd; border-radius: 8px; }
    .option { display: block; margin: 5px 0; }
    textarea { width: 100%; padding: 8px; margin-top: 10px; }
    button { margin-top: 10px; padding: 8px 12px; border: none; border-radius: 5px; cursor: pointer; }
    .save { background: #28a745; color: white; }
    .ai-generate { background: #007bff; color: white; }
  </style>
</head>
<body>
  <h2>Teacher – Quiz Creator</h2>

  <!-- AI Quiz Generator -->
  <h3>Generate Quiz with AI</h3>
  <textarea id="aiPrompt" placeholder="Enter topic or paste a paragraph..."></textarea>
  <button class="ai-generate" onclick="generateQuiz()">Generate Quiz with AI</button>

  <div id="aiStatus"></div>
  <hr>

  <!-- Manual Quiz Builder -->
  <h3>Build Quiz Manually</h3>
  <div id="questions"></div>
  <button onclick="addQuestion()">Add Question</button>
  <br><br>
  <label>Duration (minutes):</label>
  <input type="number" id="duration" value="5" min="1" />
  <br>
  <button class="save" onclick="saveQuiz()">Save Quiz</button>

  <script>
    let questionsDiv = document.getElementById("questions");

    function addQuestion(q = null) {
      const div = document.createElement("div");
      div.className = "question";
      div.innerHTML = `
        <label>Question:</label><br>
        <input type="text" class="qText" value="${q ? q.question : ""}" style="width: 100%"><br>
        <label>Options:</label><br>
        <input type="text" class="opt" value="${q ? q.options[0] : ""}"><br>
        <input type="text" class="opt" value="${q ? q.options[1] : ""}"><br>
        <input type="text" class="opt" value="${q ? q.options[2] : ""}"><br>
        <input type="text" class="opt" value="${q ? q.options[3] : ""}"><br>
        <label>Answer:</label>
        <input type="text" class="ans" value="${q ? q.answer : ""}">
      `;
      questionsDiv.appendChild(div);
    }

    async function saveQuiz() {
      const questions = [];
      document.querySelectorAll(".question").forEach(div => {
        let qText = div.querySelector(".qText").value;
        let options = Array.from(div.querySelectorAll(".opt")).map(i => i.value);
        let ans = div.querySelector(".ans").value;
        questions.push({ question: qText, options: options, answer: ans });
      });
      let duration = parseInt(document.getElementById("duration").value) || 5;

      const res = await fetch("/save", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ questions: questions, duration: duration })
      });
      const data = await res.json();
      alert(data.message);
    }

    async function generateQuiz() {
      const prompt = document.getElementById("aiPrompt").value.trim();
      if (!prompt) {
        alert("Please enter a topic or paragraph!");
        return;
      }

      document.getElementById("aiStatus").innerText = "Generating quiz... please wait ⏳";

      try {
        const res = await fetch("/generate_quiz", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ prompt: prompt })
        });
        const data = await res.json();

        if (data.error) {
          document.getElementById("aiStatus").innerText = "Error: " + data.error;
          return;
        }

        document.getElementById("aiStatus").innerText = "Quiz generated ✅";

        // Clear previous questions
        questionsDiv.innerHTML = "";

        // Add generated questions
        data.quiz.forEach(q => addQuestion(q));

      } catch (err) {
        document.getElementById("aiStatus").innerText = "Error generating quiz.";
      }
    }
  </script>
</body>
</html>
