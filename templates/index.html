<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Take Quiz</title>
<style>
  body{font-family: Arial;}
  .question{border:1px solid #ccc; margin:10px; padding:10px;}
  .option{display:block; margin:5px 0;}
</style>
</head>
<body>
<h2>Quiz</h2>
<div id="timer" style="font-weight:bold;"></div>
<form id="quizForm">
  <div id="questions"></div>
  <button type="submit">Submit Quiz</button>
</form>

<script>
let quizId="", studentName="Student";

async function loadQuiz(){
    const res = await fetch("/get_questions");
    const questions = await res.json();
    const container = document.getElementById("questions");
    questions.forEach((q,i)=>{
        const div=document.createElement("div");
        div.className="question";
        div.innerHTML=`<p>${q.question}</p>`+
                      q.options.map(opt=>`<label class="option"><input type="radio" name="q${i}" value="${opt}"> ${opt}</label>`).join('');
        container.appendChild(div);
    });
    quizId = (await fetch("/start_quiz", {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({student:studentName})
    }).then(r=>r.json())).quiz_id;
}

async function submitQuiz(e){
    e.preventDefault();
    const answers=[];
    document.querySelectorAll(".question").forEach((q,i)=>{
        const checked=q.querySelector("input[type=radio]:checked");
        answers.push(checked ? checked.value : "");
    });
    const res = await fetch("/submit_quiz", {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({student:studentName, quiz_id:quizId, answers})
    });
    const data=await res.json();
    alert(`Your Score: ${data.score} / ${data.total}`);
    window.location="/leaderboard";
}

document.getElementById("quizForm").addEventListener("submit", submitQuiz);
loadQuiz();
</script>
</body>
</html>
